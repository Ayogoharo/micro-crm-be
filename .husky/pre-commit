#!/usr/bin/env sh

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged first to auto-format staged files
if git diff --cached --name-only | grep -E '\.(ts|js)$' > /dev/null; then
  echo "ğŸ¯ Running lint-staged on staged files..."
  npm exec lint-staged
fi

# Run TypeScript compilation check after formatting
if git diff --cached --name-only | grep -E '\.(ts|js)$' > /dev/null; then
  echo "ğŸ“ Checking TypeScript compilation..."
  if ! npm run build > /dev/null 2>&1; then
    echo "âŒ TypeScript compilation failed. Please fix the errors before committing."
    npm run build
    exit 1
  fi
fi

# Run ESLint check after formatting
if git diff --cached --name-only | grep -E '\.(ts|js)$' > /dev/null; then
  echo "ğŸ”§ Running ESLint..."
  if ! npm run lint:check > /dev/null 2>&1; then
    echo "âŒ ESLint found errors. Please fix them before committing."
    npm run lint:check
    exit 1
  fi
fi

echo "âœ… Pre-commit checks passed!"
